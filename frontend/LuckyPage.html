<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Standard Meta-Tags und Titel -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DestinAI - I Feel Lucky</title>

  <!-- Einbindung von Tailwind CSS fÃ¼r das Styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            gray: {
              900: '#1a202c',
              800: '#2d3748',
            }
          }
        }
      }
    }
  </script>

  <style>
    /* Font-Import und globale Styles */
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap");

    body {
      font-family: "Inter", sans-serif;
      background-color: #f7f9fb;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    /* Animation fÃ¼r das Einblenden des ResultCards */
    .fade-in {
      animation: fadeIn 0.5s ease-out forwards;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>

<body
  class="min-h-screen flex flex-col text-gray-800 dark:text-gray-100 dark:bg-slate-900 transition-colors duration-300">
  <!-- Navbar: Konsistent mit anderen Seiten -->
  <nav class="bg-white dark:bg-slate-800 shadow-md sticky top-0 z-50 transition-colors duration-300">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <a href="MainPage.html"
          class="text-2xl font-extrabold text-indigo-600 dark:text-indigo-400 tracking-wider">DestinAI</a>
        <a href="MainPage.html"
          class="text-gray-600 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400 font-medium">Back to
          Home</a>
      </div>
    </div>
  </nav>

  <!-- Hauptinhalt: Zentriert -->
  <main class="flex-grow flex flex-col items-center justify-center p-4">
    <!-- LOADING STATE: Wird angezeigt, wÃ¤hrend Daten vom Backend geladen werden -->
    <div id="loadingState" class="text-center">
      <!-- Spinner Animation -->
      <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-pink-500 mx-auto mb-6"></div>
      <h2 class="text-2xl font-bold text-gray-700 dark:text-white">Spinning the globe...</h2>
      <p class="text-gray-500 dark:text-gray-400 mt-2">
        Selecting a destination from our database.
      </p>
    </div>

    <!-- ERROR STATE: Wird angezeigt, wenn der API-Call fehlschlÃ¤gt (StandardmÃ¤ÃŸig ausgeblendet) -->
    <div id="errorState"
      class="hidden text-center max-w-md bg-red-50 dark:bg-red-900/50 p-6 rounded-xl border border-red-100 dark:border-red-900">
      <h3 class="text-xl font-bold text-red-600 dark:text-red-400 mb-2">Oops!</h3>
      <p class="text-red-500 dark:text-red-300 mb-4" id="errorMsg">Something went wrong.</p>
      <!-- Button zum Neuladen der Seite -->
      <button onclick="location.reload()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 shadow-lg">
        Try Again
      </button>
    </div>

    <!-- RESULT CARD: Zeigt die zufÃ¤llige Stadt an (StandardmÃ¤ÃŸig ausgeblendet) -->
    <div id="resultCard"
      class="hidden w-full max-w-2xl bg-white dark:bg-slate-800 rounded-3xl shadow-2xl overflow-hidden fade-in transition-colors duration-300">
      <!-- Bildbereich mit Overlay-Text -->
      <div class="relative h-64 sm:h-80 bg-gray-200 dark:bg-slate-700">
        <img id="cityImage" src="" alt="City" class="w-full h-full object-cover" />
        <!-- Gradient Overlay fÃ¼r bessere Lesbarkeit des Textes -->
        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
        <div class="absolute bottom-6 left-6 text-white">
          <p id="cityCountry" class="text-sm font-bold uppercase tracking-wider text-pink-300 mb-1"></p>
          <h1 id="cityName" class="text-4xl sm:text-5xl font-extrabold"></h1>
        </div>
      </div>

      <!-- Inhaltsbereich -->
      <div class="p-8">
        <p id="cityDesc" class="text-lg text-gray-600 dark:text-gray-300 leading-relaxed mb-8"></p>

        <!-- Aktionsbuttons: Spin Again oder Akzeptieren -->
        <div id="decisionButtons" class="flex flex-col sm:flex-row gap-4 justify-center">
          <!-- Erneut wÃ¼rfeln -->
          <button id="spinAgainBtn"
            class="flex-1 py-4 px-6 border-2 border-gray-200 dark:border-slate-600 text-gray-600 dark:text-gray-300 font-bold rounded-xl hover:bg-gray-50 dark:hover:bg-slate-700 transition">
            Spin Again ðŸ”„
          </button>
          <!-- Akzeptieren und weiter zur Personalisierung -->
          <button id="acceptBtn"
            class="flex-1 py-4 px-6 bg-pink-500 text-white font-bold rounded-xl shadow-lg hover:bg-pink-600 transition transform hover:scale-105">
            Let's Go Here! ðŸš€
          </button>
        </div>

        <!-- HIDDEN FORM: Wird eingeblendet, wenn der Nutzer auf "Let's Go Here!" klickt -->
        <div id="detailsForm" class="hidden mt-8 pt-8 border-t border-gray-100 dark:border-slate-700 fade-in">
          <div class="bg-indigo-50 dark:bg-slate-700 p-6 rounded-xl border border-indigo-100 dark:border-slate-600">
            <label class="block text-xl font-bold text-indigo-900 dark:text-indigo-200 mb-2">Awesome! Now personalize
              it.</label>
            <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">
              What do you want to do in
              <span id="formCityName" class="font-bold">this city</span>?
            </p>
            <!-- Texteingabe fÃ¼r NutzerprÃ¤ferenzen -->
            <textarea id="userPrompt" rows="4"
              class="w-full p-4 rounded-lg border-gray-300 dark:border-slate-600 focus:ring-2 focus:ring-pink-500 bg-white dark:bg-slate-800 dark:text-white placeholder-gray-400"
              placeholder="e.g. I love museums and local food..."></textarea>
            <!-- Button zum Generieren des finalen Plans -->
            <button id="generatePlanBtn"
              class="mt-4 w-full py-4 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 shadow-md transition">
              Create My Plan
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>
  <script src="js/config.js"></script>
  <script src="js/theme-toggle.js"></script>

  <script>
    let currentCity = null;

    /**
     * Ruft eine zufÃ¤llige Stadt vom Backend ab.
     * Endpoint: /api/v1/random-city
     */
    async function getRandomCity() {
      // UI zurÃ¼cksetzen: Ladeanzeige zeigen, Rest verstecken
      document.getElementById("loadingState").classList.remove("hidden");
      document.getElementById("resultCard").classList.add("hidden");
      document.getElementById("errorState").classList.add("hidden");
      document.getElementById("detailsForm").classList.add("hidden");
      document.getElementById("decisionButtons").classList.remove("hidden");
      document.getElementById("userPrompt").value = "";

      try {
        // API-Anfrage an den lokalen Server
        const res = await fetch(`${CONFIG.API_BASE_URL}/api/lucky`);

        if (!res.ok) throw new Error("Server error");

        currentCity = await res.json();
        console.log("Random City:", currentCity);

        if (!currentCity || !currentCity.name)
          throw new Error("Invalid data");

        // UI mit den empfangenen Daten fÃ¼llen
        document.getElementById("cityImage").src =
          currentCity.image ||
          "https://via.placeholder.com/800x600?text=City";
        document.getElementById("cityCountry").textContent =
          currentCity.country || "Destination";
        document.getElementById("cityName").textContent = currentCity.name;
        document.getElementById("formCityName").textContent =
          currentCity.name;
        document.getElementById("cityDesc").textContent =
          currentCity.desc || "Explore this amazing place!";

        // Ladeanzeige ausblenden, Ergebnis anzeigen
        document.getElementById("loadingState").classList.add("hidden");
        document.getElementById("resultCard").classList.remove("hidden");
      } catch (err) {
        // Fehlerbehandlung: UI auf Fehlerzustand setzen
        console.error(err);
        document.getElementById("loadingState").classList.add("hidden");
        document.getElementById("errorState").classList.remove("hidden");
        document.getElementById("errorMsg").textContent =
          "Could not connect to the database. Please make sure the server is running.";
      }
    }

    // Initialisierung beim Laden der Seite
    document.addEventListener("DOMContentLoaded", getRandomCity);

    // Event Listener fÃ¼r "Spin Again" -> Neue Stadt laden
    document
      .getElementById("spinAgainBtn")
      .addEventListener("click", getRandomCity);

    // Event Listener fÃ¼r "Let's Go Here" -> Formular anzeigen
    document.getElementById("acceptBtn").addEventListener("click", () => {
      document.getElementById("decisionButtons").classList.add("hidden");
      document.getElementById("detailsForm").classList.remove("hidden");
    });

    // Event Listener fÃ¼r "Create My Plan" -> Daten speichern und navigieren
    document
      .getElementById("generatePlanBtn")
      .addEventListener("click", () => {
        const btn = document.getElementById("generatePlanBtn");
        btn.textContent = "Processing...";
        btn.disabled = true;

        // Datenpaket fÃ¼r die nÃ¤chste Seite vorbereiten
        const tripData = {
          cityId: currentCity.id || 999,
          cityName: currentCity.name,
          userPrompt: document.getElementById("userPrompt").value,
          dates: { start: "Flexible", end: "Flexible" },
          isLuckyFlow: true, // Flag, um den Flow zu identifizieren
        };

        // Daten im LocalStorage speichern, um sie auf FinalPage.html abzurufen
        localStorage.setItem("userPreferences", JSON.stringify(tripData));

        // Weiterleitung zur Ergebnisseite
        window.location.href = "FinalPage.html";
      });
  </script>
</body>

</html>